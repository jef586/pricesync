version: '3.8'

services:
  mobile-builder:
    container_name: prycesync-mobile-builder
    build:
      context: ./apps/mobile
      dockerfile: Dockerfile.native
    ports:
      - "5174:80"
    volumes:
      - ./apps/mobile/dist:/usr/share/nginx/html/web
      - ./apps/mobile/android/app/build/outputs/apk:/usr/share/nginx/html/apk
    environment:
      - NODE_ENV=production
      - VITE_API_BASE_URL=http://app:3000
      - VITE_COMPANY_ID=${COMPANY_ID:-default}
      - VITE_TENANT_ID=${TENANT_ID:-default}
    depends_on:
      - app
    profiles:
      - mobile-build

  mobile-dev:
    container_name: prycesync-mobile-dev
    build:
      context: ./apps/mobile
      dockerfile: Dockerfile
    ports:
      - "5174:5174"
      - "4174:4174"
    volumes:
      - ./apps/mobile:/usr/src/app
      - /usr/src/app/node_modules
    env_file:
      - ./apps/mobile/.env.development
      - ./.env.docker
    environment:
      - NODE_ENV=development
      - VITE_API_BASE_URL=http://app:3000
      - VITE_COMPANY_ID=${COMPANY_ID:-default}
      - VITE_TENANT_ID=${TENANT_ID:-default}
    depends_on:
      - app
    profiles:
      - mobile-dev